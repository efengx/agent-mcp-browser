[supervisord]
user=root
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=error


# &> /dockerstartup/vnc.log
# -geometry 1360x768 -depth 24
# [program:vncserver]
# command=bash -c "vncserver :1"
# autorestart=true
# stdout_logfile=/dev/stdout
# stderr_logfile=/dev/stderr
# priority=100
# startretries=10
# startsecs=3
# stopsignal=TERM
# stopwaitsecs=10


#   &> /dockerstartup/novnc.log
[program:novnc]
command=bash -c "sleep 7 && kill -9 $(lsof -t -i :6901) 2>/dev/null || true && ./utils/novnc_proxy --vnc localhost:5901 --listen 6901"
directory=/usr/libexec/noVNCdim
environment=DISPLAY=":1"
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
priority=200
startretries=5
startsecs=3
stopsignal=TERM
stopwaitsecs=30
depends_on=vncserver


[program:mcp-playwright]
command=bash -c "npx -y @playwright/mcp@latest --config config/browser.json --no-sandbox --save-trace > mcp-playwright.log 2>&1"
directory=/root/app
environment=DISPLAY=":1",PLAYWRIGHT_BROWSERS_PATH="%(ENV_PLAYWRIGHT_BROWSERS_PATH)s",DEBUG="pw:*",DEBUG_COLORS=0
autorestart=true
stdout_logfile=/root/app/mcp-playwright.log
stderr_logfile=/root/app/mcp-playwright.log
stdout_logfile_maxbytes=30MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=30MB
stderr_logfile_backups=3
priority=400
startretries=3
startsecs=3
stopsignal=TERM
stopwaitsecs=10


[program:mcp-browser-use]
command=bash -c ". .venv/bin/activate && fastmcp run --transport sse --host 0.0.0.0 --port 8000 mcp-server.py > mcp-browser-use.log 2>&1"
directory=/root/app
environment=DISPLAY=":1",BROWSER_USE_LOGGING_LEVEL="%(ENV_BROWSER_USE_LOGGING_LEVEL)s",ANONYMIZED_TELEMETRY="%(ENV_ANONYMIZED_TELEMETRY)s"
autorestart=true
stdout_logfile=/root/app/mcp-browser-use.log
stderr_logfile=/root/app/mcp-browser-use.log
stdout_logfile_maxbytes=30MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=30MB
stderr_logfile_backups=3
priority=500
startretries=3
startsecs=3
stopsignal=TERM
stopwaitsecs=10
depends_on=novnc


[program:chrome-cdp]
command=bash -c "./script/start-chrome-playwright.sh > chrome-debug.log"
directory=/root/app
environment=DISPLAY=":1"
autorestart=true
stdout_logfile=/root/app/chrome-debug.log
stderr_logfile=/root/app/chrome-debug.log
stdout_logfile_maxbytes=30MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=30MB
stderr_logfile_backups=3
priority=600
startretries=3
startsecs=3
stopsignal=TERM
stopwaitsecs=10
depends_on=novnc


[program:sshd]
command=/usr/sbin/sshd -D
autostart=true
autorestart=unexpected
exitcodes=255
priority=1000
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0


[program:mcp-runpod]
command=bash -c 'npx -y supergateway --stdio "node build/index.js" --port 7070 --baseUrl http://0.0.0.0:7070 --ssePath /sse --messagePath /message'
directory=/root/runpod-mcp
environment=RUNPOD_API_KEY="%(ENV_RUNPOD_API_KEY)s"
autorestart=true
stdout_logfile=/root/logs/mcp-runpod.log
stderr_logfile=/root/logs/mcp-runpod.log
stdout_logfile_maxbytes=30MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=30MB
stderr_logfile_backups=3
priority=1100
startretries=3
startsecs=3
stopsignal=TERM
stopwaitsecs=10
depends_on=novnc
